#!/bin/sh
# Do not edit the line above. This script starts and restarts the daemon
# using /bin/sh on Solaris.
if [ "X${LOCKSS_HOME}" != "X" -a -f ${LOCKSS_HOME}/etc/lockss/functions ]; then
    . ${LOCKSS_HOME}/etc/lockss/functions
elif [ -f /etc/lockss/functions ]; then
    . /etc/lockss/functions
elif [ -f ${HOME}/etc/lockss/functions ]; then
    . ${HOME}/etc/lockss/functions
else
    echo "Can't find LOCKSS functions"
    exit 1
fi
if [ "${USER}X" = "X" -o "${USER}X" = "rootX" ]; then
    echo "Must run as LOCKSS user."
    exit 1
fi
set_variables ${USER}
if [ -f ${CFG_FILE} ]; then
    . ${CFG_FILE}
else
    echo "${CFG_FILE} missing; run ${CFG_SCRIPT}"
    exit 1
fi
touch ${KEEP_GOING}
while [ -f ${KEEP_GOING} ]; do
    ${LOCKSS_HOME}/etc/lockss/rundaemon wait
    EXIT_CODE=$?
    echo stopped with status ${EXIT_CODE} at `date` >>${LOG_FILE}
    if [ -f ${KEEP_GOING} ]; then
        sleep 30
    fi
done &
exit 0
