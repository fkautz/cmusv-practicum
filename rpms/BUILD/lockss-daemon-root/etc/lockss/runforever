#!/bin/sh

. /etc/lockss/functions

if [ "${USER}X" = "X" -o "${USER}X" = "rootX" ]
then
    echo "Must run as LOCKSS user."
    exit 1
fi
set_variables ${USER}
if [ -f ${CFG_FILE} ]; then
  . ${CFG_FILE}
else
  echo "${CFG_FILE} missing; run ${CFG_SCRIPT}"
  exit 1
fi

touch ${KEEP_GOING}

while [ -f ${KEEP_GOING} ]; do
    ${LOCKSS_HOME}/etc/lockss/rundaemon wait
    EXIT_CODE=$?
    echo stopped with status ${EXIT_CODE} at `date` >>${LOG_FILE}
    if [ -f ${KEEP_GOING} ]; then
	sleep 30
    fi
done &
exit 0
